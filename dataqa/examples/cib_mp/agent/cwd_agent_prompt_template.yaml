agent_name: "cib_mp"

llm_configs:
  gpt-4.1:
    type: "dataqa.llm.openai.AzureOpenAI"
    config:
      model: "gpt-4.1-2025-04-14"
      api_version: "2024-08-01-preview"
      api_type: "azure_ad"
      temperature: 0
      num_response: 1

  gpt-4o:
    type: "dataqa.llm.openai.AzureOpenAI"
    config:
      model: "gpt-4o-2024-08-06"
      api_version: "2024-08-01-preview"
      api_type: "azure_ad"
      temperature: 0
      num_response: 1
      azure_model_params:
        model_name: "gpt-4o"

  o3-mini:
    type: "dataqa.llm.openai.AzureOpenAI"
    config:
      model: "o3-mini-2025-01-31"
      api_version: "2025-03-01-preview"
      api_type: "azure_ad"
      temperature: 1
      num_response: 1
      azure_model_params:
        model_name: "o3-mini"

llm:
  default: gpt-4.1
  planner: o3-mini
  replanner: o3-mini
  retrieval_worker: gpt-4.1
  analytics_worker: gpt-4.1
  plot_worker: gpt-4.1


workers:
  retrieval_worker:
    sql_execution_config:
      data_files:
        - path: "examples/cib_mp/data/fake_PROD_BD_TH_FLAT_V3.csv"
          table_name: "PROD_BD_TH_FLAT_V3"
        - path: "examples/cib_mp/data/fake_EIS_D_CUST_PORTFOLIO.csv"
          table_name: "EIS_D_CUST_PORTFOLIO"

prompts:
  use_case_name: Merchant Payments
  use_case_description: |
    In this use case, you work as a AI assistant to answer users' queries about two data tables, PROD_BD_TH_FLAT_V3 and EIS_D_CUST_PORTFOLIO.
    Users may ask you to extract data from these two tables, with follow-up steps for data analytics and data visualization.
  use_case_planner_instruction: |
    Please do not use analytics worker. Try to complete analytics in retrieval worker through SQL
    - To calculate sales volume by MOP
      - merge ('VI','VR','CR','CZ') to 'VI'
      - merge ('MC','MR') to 'MC'
      - merge ('DI','DD','JC') to 'DI'
      - keep the rest MOP value as separate group
    - USA is synonym of US. When question is asking about Region US, use where condition: CUST_COUNTRY_CD in ('US', 'USA')
    - To get sales volume for Visa, sum over the values in ('VI','VR','CR','CZ')
    - For question asking TD, which is one code of customer type, use column CUST_TYPE_CD to filter on code TD

    ---
    Refer to the follow examples. Each example present a user question and the reasoning and SQL to solve this question.

    Q: Give me all companies that are active.
    A:
    <reasoning>
    To list all active companies, we need to:

    1. **Filter Active Companies**:
      - Use the `cust_stat` column to filter for active companies (`cust_stat = 'A'`).

    2. **Select Unique Companies**:
      - Select distinct `ownrshp_comp_lvl_1_extl_id` as `comp_id` and `ownrshp_comp_lvl_1_name` as `comp_name` to get a list of unique active companies.
    </reasoning>

    <output>
    df_comp
    </output>

    <sql>
    SELECT DISTINCT ownrshp_comp_lvl_1_extl_id AS comp_id, ownrshp_comp_lvl_1_name AS comp_name
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A';
    </sql>

    Q: What are the TD associated with 456 company ID?
    A:
    <reasoning>
    To find the TD associated with company ID 456, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '456'`).

    4. **Select Relevant Columns**:
      - Select `ownrshp_comp_lvl_1_extl_id` as `co_number`, `cust_name` as `td_name`, and `cust_extl_id` as `td_id`.
    </reasoning>

    <sql>
    SELECT
        ownrshp_comp_lvl_1_extl_id AS co_number,
        cust_name AS td_name,
        cust_extl_id AS td_id
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A'
      AND cust_type_cd = 'TD'
      AND ownrshp_comp_lvl_1_extl_id IN ('456')
    GROUP BY ownrshp_comp_lvl_1_extl_id, cust_name, cust_extl_id;
    </sql>

    Q: Give me a list of Active TDs for 456 company in USA
    A:
    <reasoning>
    To list active TDs for company ID 456 in the USA, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1002'`).

    4. **Filter by Country**:
      - Use the `CUST_COUNTRY_CD` column to filter for the USA (`CUST_COUNTRY_CD IN ('USA', 'US')`).

    5. **Select Relevant Columns**:
      - Select `ownrshp_comp_lvl_1_extl_id` as `co_number`, `cust_name` as `td_name`, and `cust_extl_id` as `td_id`.
    </reasoning>

    <sql>
    SELECT
        ownrshp_comp_lvl_1_extl_id AS co_number,
        cust_name AS td_name,
        cust_extl_id AS td_id
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A'
      AND cust_type_cd = 'TD'
      AND ownrshp_comp_lvl_1_extl_id IN ('1002')
      AND CUST_COUNTRY_CD IN ('USA', 'US')
    GROUP BY ownrshp_comp_lvl_1_extl_id, cust_name, cust_extl_id;
    </sql>

    Q: What is the list of Terminated TDs for 456 company, can you give me the list by merchant country?
    A:
    <reasoning>
    To list terminated TDs for company ID 456 by merchant country, we need to:

    1. **Filter Terminated TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for terminated TDs (`cust_stat = 'T'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1004'`).

    4. **Select Relevant Columns**:
      - Select `ownrshp_comp_lvl_1_extl_id` as `co_number`, `CUST_COUNTRY_CD`, `cust_name` as `td_name`, and `cust_extl_id` as `td_id`.
    </reasoning>

    <sql>
    SELECT
        ownrshp_comp_lvl_1_extl_id AS co_number,
        CUST_COUNTRY_CD,
        cust_name AS td_name,
        cust_extl_id AS td_id
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'T'
      AND cust_type_cd = 'TD'
      AND ownrshp_comp_lvl_1_extl_id IN ('1004')
    GROUP BY ownrshp_comp_lvl_1_extl_id, CUST_COUNTRY_CD, cust_name, cust_extl_id;
    </sql>

    Q: What are the MCC CD and MCC Desc associated with Co_ID 1003?
    A:
    <reasoning>
    To find the MCC CD and MCC Desc associated with company ID 1003, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1003'`).

    4. **Select Relevant Columns**:
      - Select `OWNRSHP_COMP_LVL_1_NAME` as `co_name`, `ownrshp_comp_lvl_1_extl_id` as `co_number`, `mcc_cd`, and `mcc_desc`.
    </reasoning>

    <sql>
    SELECT
        OWNRSHP_COMP_LVL_1_NAME AS co_name,
        ownrshp_comp_lvl_1_extl_id AS co_number,
        mcc_cd,
        mcc_desc
    FROM EIS_D_CUST_PORTFOLIO
    WHERE ownrshp_comp_lvl_1_extl_id IN ('1003')
      AND cust_stat = 'A'
      AND cust_type_cd = 'TD'
    GROUP BY OWNRSHP_COMP_LVL_1_NAME, ownrshp_comp_lvl_1_extl_id, mcc_cd, mcc_desc;
    </sql>

    Q: What TD operate in Canada for co_id 1005?
    A:
    <reasoning>
    To find TDs operating in Canada for company ID 1005, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Country**:
      - Use the `cust_country_Cd` column to filter for Canada (`cust_country_Cd IN ('CAN')`).

    4. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1005'`).

    5. **Select Relevant Columns**:
      - Select `OWNRSHP_COMP_LVL_1_NAME` as `co_name`, `OWNRSHP_COMP_LVL_1_EXTL_ID` as `co_id`, `CUST_EXTL_ID` as `TD_ID`, `CUST_NAME` as `TD_Name`, and `CUST_COUNTRY_CD`.
    </reasoning>

    <sql>
    SELECT
        OWNRSHP_COMP_LVL_1_NAME AS co_name,
        OWNRSHP_COMP_LVL_1_EXTL_ID AS co_id,
        CUST_EXTL_ID AS TD_ID,
        CUST_NAME AS TD_Name,
        CUST_COUNTRY_CD
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A'
      AND cust_type_cd = 'TD'
      AND cust_country_Cd IN ('CAN')
      AND ownrshp_comp_lvl_1_extl_id IN ('1005')
    GROUP BY OWNRSHP_COMP_LVL_1_NAME, OWNRSHP_COMP_LVL_1_EXTL_ID, CUST_EXTL_ID, CUST_NAME, CUST_COUNTRY_CD;
    </sql>

    Q: What is the gross sales for Co_ID 1001 in the month of September 2024?
    A:
    <reasoning>
    To find the gross sales for company ID 1001 in September 2024, we need to:

    1. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1005'`).

    2. **Filter by Month**:
      - Use the `subm_dt_yyyymm` column to filter for September 2024 (`subm_dt_yyyymm = '202409'`).

    3. **Filter by Sale Type**:
      - Use the `sale_refund_cd` column to filter for sales (`sale_refund_cd = 'S'`).

    4. **Aggregate Sales Data**:
      - Sum `gross_sales_usd` and `gross_sales_units` to get the total gross sales.
    </reasoning>

    <sql>
    SELECT
        co_id,
        sale_refund_cd,
        subm_dt_yyyymm AS month,
        SUM(gross_sales_usd) AS gross_sales_usd,
        SUM(gross_sales_units) AS gross_sales_units
    FROM PROD_BD_TH_FLAT_V3
    WHERE co_id IN ('1005')
      AND subm_dt_yyyymm IN ('202409')
      AND sale_refund_cd IN ('S')
    GROUP BY co_id, sale_refund_cd, subm_dt_yyyymm;
    </sql>

    Q: What is the processing volume and sales units for co_id 1005 for yesterday?
    A:
    <reasoning>
    To find the processing volume and sales units for company ID 1005 for yesterday, we need to:

    1. **Filter by Date**:
      - Use the `subm_dt` column to filter for yesterday's date (`subm_dt = date('now', '-1 day')`).

    2. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1005'`).

    3. **Filter by Sale Type**:
      - Use the `sale_refund_cd` column to filter for sales (`sale_refund_cd = 'S'`).

    4. **Aggregate Sales Data**:
      - Sum `gross_sales_units` and `gross_sales_usd` to get the total processing volume and sales units.
    </reasoning>

    <sql>
    SELECT
        co_id,
        subm_dt,
        SUM(gross_sales_units) AS gross_sales_units,
        SUM(gross_sales_usd) AS gross_sales_usd
    FROM PROD_BD_TH_FLAT_V3
    WHERE subm_dt = date('now', '-1 day')
      AND co_id IN ('1005')
      AND sale_refund_cd IN ('S')
    GROUP BY co_id, subm_dt;
    </sql>

    Q: What is the processing volume for CO_ID 1004 for last 6 months?
    A:
    <reasoning>
    To find the processing volume for company ID 1004 for the last 6 months, we need to:

    1. **Filter by Date Range**:
      - Use the `subm_dt` column to filter for the last 6 months (`subm_dt >= date('now', 'start of month', '-6 months')`).

    2. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1004'`).

    3. **Aggregate Sales Data**:
      - Sum `gross_sales_units` and `gross_sales_usd` to get the total processing volume.

    4. **Order by Sales Volume**:
      - Order the results by `gross_sales_usd` in descending order.
    </reasoning>

    <sql>
    SELECT
        co_id,
        SUM(gross_sales_units) AS gross_sales_units,
        SUM(gross_sales_usd) AS gross_sales_usd
    FROM PROD_BD_TH_FLAT_V3
    WHERE subm_dt >= date('now', 'start of month', '-6 months')
      AND co_id IN ('1004')
    GROUP BY co_id
    ORDER BY gross_sales_usd DESC;
    </sql>

    Q: What is the total gross sales unit by MOP code in the month of September 2024?
    A:
    <reasoning>
    To find the total sales unit by MOP code in the month of September 2024, we need to:

    1. **Filter by Date Range**:
      - Use the `subm_dt_yyyymm` column to filter for September 2024 (`subm_dt_yyyymm = '202409'`).

    2. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1004'`).

    3. **Aggregate Sales Data**:
      - Sum `gross_sales_units`  to get the total unit.

    </reasoning>

    <sql>
    SELECT CASE WHEN mop_cd in ('VI','VR','CR','CZ') THEN 'VI' WHEN mop_cd in ('MC','MR') THEN 'MC' WHEN mop_cd in ('DI','DD','JC') THEN 'DI' ELSE mop_cd END brand,
        SUM(gross_sales_units) AS gross_sales_units,
    FROM PROD_BD_TH_FLAT_V3
    WHERE subm_dt_yyyymm IN ('202409')
    GROUP BY brand
    </sql>
  use_case_replanner_instruction: |
    Please do not use analytics worker. Try to complete analytics in retrieval worker through SQL
    - To calculate sales volume by MOP
      - merge ('VI','VR','CR','CZ') to 'VI'
      - merge ('MC','MR') to 'MC'
      - merge ('DI','DD','JC') to 'DI'
      - keep the rest MOP value as separate group
    - USA is synonym of US. When question is asking about Region US, use where condition: CUST_COUNTRY_CD in ('US', 'USA')
    - To get sales volume for Visa, sum over the values in ('VI','VR','CR','CZ')
    - For question asking TD, which is one code of customer type, use column CUST_TYPE_CD to filter on code TD

    ---
    Refer to the follow examples. Each example present a user question and the reasoning and SQL to solve this question.

    Q: Give me all companies that are active.
    A:
    <reasoning>
    To list all active companies, we need to:

    1. **Filter Active Companies**:
      - Use the `cust_stat` column to filter for active companies (`cust_stat = 'A'`).

    2. **Select Unique Companies**:
      - Select distinct `ownrshp_comp_lvl_1_extl_id` as `comp_id` and `ownrshp_comp_lvl_1_name` as `comp_name` to get a list of unique active companies.
    </reasoning>

    <output>
    df_comp
    </output>

    <sql>
    SELECT DISTINCT ownrshp_comp_lvl_1_extl_id AS comp_id, ownrshp_comp_lvl_1_name AS comp_name
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A';
    </sql>

    Q: What are the TD associated with 456 company ID?
    A:
    <reasoning>
    To find the TD associated with company ID 456, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '456'`).

    4. **Select Relevant Columns**:
      - Select `ownrshp_comp_lvl_1_extl_id` as `co_number`, `cust_name` as `td_name`, and `cust_extl_id` as `td_id`.
    </reasoning>

    <sql>
    SELECT
        ownrshp_comp_lvl_1_extl_id AS co_number,
        cust_name AS td_name,
        cust_extl_id AS td_id
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A'
      AND cust_type_cd = 'TD'
      AND ownrshp_comp_lvl_1_extl_id IN ('456')
    GROUP BY ownrshp_comp_lvl_1_extl_id, cust_name, cust_extl_id;
    </sql>

    Q: Give me a list of Active TDs for 456 company in USA
    A:
    <reasoning>
    To list active TDs for company ID 456 in the USA, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1002'`).

    4. **Filter by Country**:
      - Use the `CUST_COUNTRY_CD` column to filter for the USA (`CUST_COUNTRY_CD IN ('USA', 'US')`).

    5. **Select Relevant Columns**:
      - Select `ownrshp_comp_lvl_1_extl_id` as `co_number`, `cust_name` as `td_name`, and `cust_extl_id` as `td_id`.
    </reasoning>

    <sql>
    SELECT
        ownrshp_comp_lvl_1_extl_id AS co_number,
        cust_name AS td_name,
        cust_extl_id AS td_id
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A'
      AND cust_type_cd = 'TD'
      AND ownrshp_comp_lvl_1_extl_id IN ('1002')
      AND CUST_COUNTRY_CD IN ('USA', 'US')
    GROUP BY ownrshp_comp_lvl_1_extl_id, cust_name, cust_extl_id;
    </sql>

    Q: What is the list of Terminated TDs for 456 company, can you give me the list by merchant country?
    A:
    <reasoning>
    To list terminated TDs for company ID 456 by merchant country, we need to:

    1. **Filter Terminated TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for terminated TDs (`cust_stat = 'T'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1004'`).

    4. **Select Relevant Columns**:
      - Select `ownrshp_comp_lvl_1_extl_id` as `co_number`, `CUST_COUNTRY_CD`, `cust_name` as `td_name`, and `cust_extl_id` as `td_id`.
    </reasoning>

    <sql>
    SELECT
        ownrshp_comp_lvl_1_extl_id AS co_number,
        CUST_COUNTRY_CD,
        cust_name AS td_name,
        cust_extl_id AS td_id
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'T'
      AND cust_type_cd = 'TD'
      AND ownrshp_comp_lvl_1_extl_id IN ('1004')
    GROUP BY ownrshp_comp_lvl_1_extl_id, CUST_COUNTRY_CD, cust_name, cust_extl_id;
    </sql>

    Q: What are the MCC CD and MCC Desc associated with Co_ID 1003?
    A:
    <reasoning>
    To find the MCC CD and MCC Desc associated with company ID 1003, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1003'`).

    4. **Select Relevant Columns**:
      - Select `OWNRSHP_COMP_LVL_1_NAME` as `co_name`, `ownrshp_comp_lvl_1_extl_id` as `co_number`, `mcc_cd`, and `mcc_desc`.
    </reasoning>

    <sql>
    SELECT
        OWNRSHP_COMP_LVL_1_NAME AS co_name,
        ownrshp_comp_lvl_1_extl_id AS co_number,
        mcc_cd,
        mcc_desc
    FROM EIS_D_CUST_PORTFOLIO
    WHERE ownrshp_comp_lvl_1_extl_id IN ('1003')
      AND cust_stat = 'A'
      AND cust_type_cd = 'TD'
    GROUP BY OWNRSHP_COMP_LVL_1_NAME, ownrshp_comp_lvl_1_extl_id, mcc_cd, mcc_desc;
    </sql>

    Q: What TD operate in Canada for co_id 1005?
    A:
    <reasoning>
    To find TDs operating in Canada for company ID 1005, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Country**:
      - Use the `cust_country_Cd` column to filter for Canada (`cust_country_Cd IN ('CAN')`).

    4. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1005'`).

    5. **Select Relevant Columns**:
      - Select `OWNRSHP_COMP_LVL_1_NAME` as `co_name`, `OWNRSHP_COMP_LVL_1_EXTL_ID` as `co_id`, `CUST_EXTL_ID` as `TD_ID`, `CUST_NAME` as `TD_Name`, and `CUST_COUNTRY_CD`.
    </reasoning>

    <sql>
    SELECT
        OWNRSHP_COMP_LVL_1_NAME AS co_name,
        OWNRSHP_COMP_LVL_1_EXTL_ID AS co_id,
        CUST_EXTL_ID AS TD_ID,
        CUST_NAME AS TD_Name,
        CUST_COUNTRY_CD
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A'
      AND cust_type_cd = 'TD'
      AND cust_country_Cd IN ('CAN')
      AND ownrshp_comp_lvl_1_extl_id IN ('1005')
    GROUP BY OWNRSHP_COMP_LVL_1_NAME, OWNRSHP_COMP_LVL_1_EXTL_ID, CUST_EXTL_ID, CUST_NAME, CUST_COUNTRY_CD;
    </sql>

    Q: What is the gross sales for Co_ID 1001 in the month of September 2024?
    A:
    <reasoning>
    To find the gross sales for company ID 1001 in September 2024, we need to:

    1. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1005'`).

    2. **Filter by Month**:
      - Use the `subm_dt_yyyymm` column to filter for September 2024 (`subm_dt_yyyymm = '202409'`).

    3. **Filter by Sale Type**:
      - Use the `sale_refund_cd` column to filter for sales (`sale_refund_cd = 'S'`).

    4. **Aggregate Sales Data**:
      - Sum `gross_sales_usd` and `gross_sales_units` to get the total gross sales.
    </reasoning>

    <sql>
    SELECT
        co_id,
        sale_refund_cd,
        subm_dt_yyyymm AS month,
        SUM(gross_sales_usd) AS gross_sales_usd,
        SUM(gross_sales_units) AS gross_sales_units
    FROM PROD_BD_TH_FLAT_V3
    WHERE co_id IN ('1005')
      AND subm_dt_yyyymm IN ('202409')
      AND sale_refund_cd IN ('S')
    GROUP BY co_id, sale_refund_cd, subm_dt_yyyymm;
    </sql>

    Q: What is the processing volume and sales units for co_id 1005 for yesterday?
    A:
    <reasoning>
    To find the processing volume and sales units for company ID 1005 for yesterday, we need to:

    1. **Filter by Date**:
      - Use the `subm_dt` column to filter for yesterday's date (`subm_dt = date('now', '-1 day')`).

    2. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1005'`).

    3. **Filter by Sale Type**:
      - Use the `sale_refund_cd` column to filter for sales (`sale_refund_cd = 'S'`).

    4. **Aggregate Sales Data**:
      - Sum `gross_sales_units` and `gross_sales_usd` to get the total processing volume and sales units.
    </reasoning>

    <sql>
    SELECT
        co_id,
        subm_dt,
        SUM(gross_sales_units) AS gross_sales_units,
        SUM(gross_sales_usd) AS gross_sales_usd
    FROM PROD_BD_TH_FLAT_V3
    WHERE subm_dt = date('now', '-1 day')
      AND co_id IN ('1005')
      AND sale_refund_cd IN ('S')
    GROUP BY co_id, subm_dt;
    </sql>

    Q: What is the processing volume for CO_ID 1004 for last 6 months?
    A:
    <reasoning>
    To find the processing volume for company ID 1004 for the last 6 months, we need to:

    1. **Filter by Date Range**:
      - Use the `subm_dt` column to filter for the last 6 months (`subm_dt >= date('now', 'start of month', '-6 months')`).

    2. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1004'`).

    3. **Aggregate Sales Data**:
      - Sum `gross_sales_units` and `gross_sales_usd` to get the total processing volume.

    4. **Order by Sales Volume**:
      - Order the results by `gross_sales_usd` in descending order.
    </reasoning>

    <sql>
    SELECT
        co_id,
        SUM(gross_sales_units) AS gross_sales_units,
        SUM(gross_sales_usd) AS gross_sales_usd
    FROM PROD_BD_TH_FLAT_V3
    WHERE subm_dt >= date('now', 'start of month', '-6 months')
      AND co_id IN ('1004')
    GROUP BY co_id
    ORDER BY gross_sales_usd DESC;
    </sql>

    Q: What is the total gross sales unit by MOP code in the month of September 2024?
    A:
    <reasoning>
    To find the total sales unit by MOP code in the month of September 2024, we need to:

    1. **Filter by Date Range**:
      - Use the `subm_dt_yyyymm` column to filter for September 2024 (`subm_dt_yyyymm = '202409'`).

    2. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1004'`).

    3. **Aggregate Sales Data**:
      - Sum `gross_sales_units`  to get the total unit.

    </reasoning>

    <sql>
    SELECT CASE WHEN mop_cd in ('VI','VR','CR','CZ') THEN 'VI' WHEN mop_cd in ('MC','MR') THEN 'MC' WHEN mop_cd in ('DI','DD','JC') THEN 'DI' ELSE mop_cd END brand,
        SUM(gross_sales_units) AS gross_sales_units,
    FROM PROD_BD_TH_FLAT_V3
    WHERE subm_dt_yyyymm IN ('202409')
    GROUP BY brand
    </sql>
  use_case_schema: |
    -- This table contains details about customer hierarchy.

    CREATE TABLE EIS_D_CUST_PORTFOLIO (

        /*
        description: Surrogate Key Identifier - Identifies a unique occurrence of a system generated alternate key based on the natural key. Used to join across various tables as this is faster than joining on natural keys and is not the customer facing account number.
        */
        CUST_KEY NUMBER,

        /*
        description: Merchant Identifier - Identifies a merchant acquiring account that processes transactions on one of the Firm's payment processing systems. This identifier can be from any of the Firm's payment processing systems. The identifier can be at varying levels of the account hierarchy such as the company, business unit, transaction division, etc. When necessary, the hierarchy level should be defined by corresponding attribute merchant hierarchy level code.
        */
        CUST_ID TEXT,

        /*
        description: Enterprise Party Identifier, ECID, Enterprise ID - The Firm-declared authoritative unique identifier assigned to an external party involved in some manner with the Firm. This is a system-generated element that uses party name, address, and Tax Government Issued Identifier to define a unique individual or non-individual. The identifier is used for operational purposes. This critical data element is commonly referred to as the ECI (Enterprise Customer ID) or ECID and was formerly called the Enterprise Customer Identifier.
        */
        BANK_ENTERPRISE_CUST_ID TEXT,

        /*
        description: Merchant Doing Business As Name, TD Name - The moniker given to an alias name for a Merchant labeled as D.B.A. that is different from the legal name.
        */
        CUST_NAME TEXT,

        /*
        description: Merchant Hierarchy Level Code - Codifies the level of the merchant relationship as it relates to the acquiring account.
        values:
          This column contains only these values: BU - Business Unit, TD - Transaction Division, CO - Company Highest Level, OU - First Data Merchant Services Outlet Number, CH - First Data Merchant Services North Chain Number
        */
        CUST_TYPE_CD TEXT,

        /*
        description: Party Address State Province Code - Classifies a geographic area that represents a first level, legal and political subdivision of a country; for example, Virginia, Bavaria.
        values:
          Some example values: AL - Alabama, AK - Alaska, AZ - Arizona, AR - Arkansas, CA - California
        */
        CUST_STATE_CD TEXT,

        /*
        description: Party Address Country Code - A code that identifies the Country, a Geographic Area, that is recognized as an independent political unit in world affairs. Note: This data element is a child of the Country Code CDE and valid values are based on ISO standards. The physical country code of the merchant.
        */
        CUST_COUNTRY_CD TEXT,

        /*
        description: Merchant Acquirer Reporting Identifier, TD_ID, TD_Number - Identifies a unique occurrence of reporting identifier used for transaction reporting that identifies a merchant or group of merchants at a company, transaction division, or reporting group level. This may be the same level as one of the hierarchy levels. This is commonly referred to as PTMBRENT.
        */
        CUST_EXTL_ID TEXT,

        /*
        description: Merchant Acquirer Account Status Code - Codifies the status of a Merchant card processing account number as set up for the merchant.
        values:
          This column contains only these values: T - Terminated, A - Active, R - Ready, N - N/A, S - Setup
        */
        CUST_STAT TEXT,

        /*
        description: Merchant Category Code - Codifies a merchant's primary goods or services sold, this is a four-digit number associated with a business by a credit/debit card merchant acquirer or merchant transaction processor.
        */
        MCC_CD TEXT,

        /*
        description: Merchant Category Description - Codifies a merchant's primary goods or services sold, description of a business by a credit/debit card merchant acquirer or merchant transaction processor.
        */
        MCC_DESC TEXT,

        /*
        description: Account Management Segment Code - Codifies the relationship management team responsible for the Special Markets, Regional or National accounts by account executive profile.
        values:
          Some example values: SMBUS - Small Business - Small Business, NATNL - National - National, MDMKT - Mid Market - Mid Market, CAN-SMBUS - Small Business - Canadian Small Business, Associations - Associations
        */
        MKTSEG_CD TEXT,

        /*
        description: Merchant Acquirer Company Name, Company Name, Co Name - The label given to a unique entity which represents a relationship at the highest of the three levels of the account hierarchy of the back-end proprietary merchant acquiring processing platform. Complex organizations may be represented by grouping multiple company identifiers. The full hierarchy consists of company identifier, business unit identifier, and transaction division identifier.
        */
        OWNRSHP_COMP_LVL_1_NAME TEXT,

        /*
        description: Merchant Acquirer Reporting Identifier, Company ID, Co_ID, Company Number, Co Number - Identifies a unique occurrence of reporting identifier used for transaction reporting that identifies a merchant or group of merchants at a company, transaction division, or reporting group level. This may be the same level as one of the hierarchy levels. This is commonly referred to as PTMBRENT.
        */
        OWNRSHP_COMP_LVL_1_EXTL_ID TEXT,

    );

    -- This table contains information about customer transaction details.

    CREATE TABLE PROD_BD_TH_FLAT_V3 (

        /*
        description: Party Address Country Code - The portion of a party's address that is the encoded representation of a geographic area representing a country.
        */
        ACCT_COUNTRY_CD TEXT,

        /*
        description: Party Address Country Code - The portion of a party's address that is the encoded representation of a geographic area representing a country.
        values:
          Some example values: ABW - Aruba, AIA - Anguilla, ANT - Netherlands Antilles, ARE - United Arab Emirates, ARG - Argentine Republic
        */
        COUNTRY TEXT,

        /*
        description: Payment method code - Codifies the method used to pay for the exchange of money, goods or services between a merchant and their customer.
        values:
          Some example values: DD - Discover Diners, FD - Military Cards, BC - Bank Cards, C5 - Office Max Business Cards
        usage:
          To calculate sales volume by MOP
            - merge ('VI','VR','CR','CZ') to 'VI'
            - merge ('MC','MR') to 'MC'
            - merge ('DI','DD','JC') to 'DI'
            - keep the rest MOP value as separate group
          To get sales volume for Visa, sum over the values in ('VI','VR','CR','CZ')
        */
        MOP_CD TEXT,

        /*
        description: Transaction Type Code - Codifies a grouping of payment transactions with similar processing characteristics such as retails transactions, mail order transactions, etc.
        values:
          Some example values: R - Retail - Retail, 8 - non secure txn - Non Secure Transaction, 7 - non SET channel encrypted txn - Non Settled Channel Encrypted Transaction (don't pay), 6 - Non Authenticated SET txn - Non Authenticated Settled Transaction, 5 - SET txn - Settled Transaction
        */
        TXN_TYPE TEXT,

        /*
        description: Settlement File Submission Timestamp - Designates the hour (hh), minute (mm), seconds (ss) and date (if timestamp) or year (YYYY), month (MM), and day (DD) (if date) when a file of transactions were submitted for a merchant regarding monetary/non-monetary credit or debit transactions for billing and reporting purposes. The file can be submitted by the merchant or an internal system of the Firm.
        */
        SUBM_DT_YYYYMM NUMBER,

        /*
        description: Company Identifier - Identifier for a company where there are multiple accounts related to the customer. This is the ability to link them together.
        */
        CO_ID TEXT,

        /*
        description: Settlement Currency Code - Codifies the monetary unit that is used to resolve the outstanding transaction between two parties. (such as Merchant Accounts, Company, Cardholder Accounts, etc.)
        values:
          Some example values: HKD - Hong Kong Dollar, CAD - Canadian Dollars, EUR - Euro, USD - United States Dollar
        */
        CURRENCY_CD TEXT,

        /*
        description: Merchant Acquirer Reporting Identifier - A unique identifier for a merchant or group of merchants at a company, transaction division, or reporting group level used for transaction reporting purposes for the merchant.
        */
        MBR_ENT TEXT,

        /*
        description: Firm Authorization Response Code - Codifies the Firm's representation of the authorization response code being sent back to the merchant during credit card authorization.
        values:
          Some example values: 100 - Approved, 302 - Credit Floor, 303 - Processor Decline, 501 - Pickup, 502 - Lost/Stolen
        */
        OUR_AUTH_RESPONSE TEXT,

        /*
        description: Settlement File Submission Timestamp - Designates the hour (hh), minute (mm), seconds (ss) and date (if timestamp) or year (YYYY), month (MM), and day (DD) (if date) when a file of transactions were submitted for a merchant regarding monetary/non-monetary credit or debit transactions for billing and reporting purposes. The file can be submitted by the merchant or an internal system of the Firm.
        */
        SUBM_DT TEXT,

        /*
        description: Transaction Identifier - Identifies a unique occurrence of a transaction.
        */
        TXN_DETAIL_ID TEXT,

        /*
        description: Payment Endpoint Code - Codifies the payment source responsible for funding the transaction that was processed on behalf of the merchant.
        values:
          Some example values: ACS - ACS PL, AMX - Amex USD, AXG - Amex Settled Global CA, AXI - Amex Intl, AXN - Amex Settled NAP CA
        */
        PTENDPOINT TEXT,

        /*
        description: Transaction Count - Enumerates the occurrences of any transaction within a given period.
        */
        GROSS_SALES_UNITS NUMBER,

        /*
        description: Finance Profitability Gross Sales Amount - Specifies the monetary value of the sum of merchandise purchase amounts posted to the account during a given period.
        */
        GROSS_SALES_USD NUMBER,

        /*
        description: Settlement Currency Code - Codifies the monetary unit that is used to resolve the outstanding transaction between two parties. (such as Merchant Accounts, Company, Cardholder Accounts, etc.)
        */
        SETTLED_CURRENCY_CD TEXT,

    );
  use_case_sql_instruction: |
    - To calculate sales volume by MOP
      - merge ('VI','VR','CR','CZ') to 'VI'
      - merge ('MC','MR') to 'MC'
      - merge ('DI','DD','JC') to 'DI'
      - keep the rest MOP value as separate group
    - USA is synonym of US. When question is asking about Region US, use where condition: CUST_COUNTRY_CD in ('US', 'USA')
    - To get sales volume for Visa, sum over the values in ('VI','VR','CR','CZ')
    - For question asking TD, which is one code of customer type, use column CUST_TYPE_CD to filter on code TD
  use_case_sql_example: |
    Q: Give me all companies that are active.
    A:
    <reasoning>
    To list all active companies, we need to:

    1. **Filter Active Companies**:
      - Use the `cust_stat` column to filter for active companies (`cust_stat = 'A'`).

    2. **Select Unique Companies**:
      - Select distinct `ownrshp_comp_lvl_1_extl_id` as `comp_id` and `ownrshp_comp_lvl_1_name` as `comp_name` to get a list of unique active companies.
    </reasoning>

    <output>
    df_comp
    </output>

    <sql>
    SELECT DISTINCT ownrshp_comp_lvl_1_extl_id AS comp_id, ownrshp_comp_lvl_1_name AS comp_name
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A';
    </sql>

    Q: What are the TD associated with 456 company ID?
    A:
    <reasoning>
    To find the TD associated with company ID 456, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '456'`).

    4. **Select Relevant Columns**:
      - Select `ownrshp_comp_lvl_1_extl_id` as `co_number`, `cust_name` as `td_name`, and `cust_extl_id` as `td_id`.
    </reasoning>

    <sql>
    SELECT
        ownrshp_comp_lvl_1_extl_id AS co_number,
        cust_name AS td_name,
        cust_extl_id AS td_id
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A'
      AND cust_type_cd = 'TD'
      AND ownrshp_comp_lvl_1_extl_id IN ('456')
    GROUP BY ownrshp_comp_lvl_1_extl_id, cust_name, cust_extl_id;
    </sql>

    Q: Give me a list of Active TDs for 456 company in USA
    A:
    <reasoning>
    To list active TDs for company ID 456 in the USA, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1002'`).

    4. **Filter by Country**:
      - Use the `CUST_COUNTRY_CD` column to filter for the USA (`CUST_COUNTRY_CD IN ('USA', 'US')`).

    5. **Select Relevant Columns**:
      - Select `ownrshp_comp_lvl_1_extl_id` as `co_number`, `cust_name` as `td_name`, and `cust_extl_id` as `td_id`.
    </reasoning>

    <sql>
    SELECT
        ownrshp_comp_lvl_1_extl_id AS co_number,
        cust_name AS td_name,
        cust_extl_id AS td_id
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A'
      AND cust_type_cd = 'TD'
      AND ownrshp_comp_lvl_1_extl_id IN ('1002')
      AND CUST_COUNTRY_CD IN ('USA', 'US')
    GROUP BY ownrshp_comp_lvl_1_extl_id, cust_name, cust_extl_id;
    </sql>

    Q: What is the list of Terminated TDs for 456 company, can you give me the list by merchant country?
    A:
    <reasoning>
    To list terminated TDs for company ID 456 by merchant country, we need to:

    1. **Filter Terminated TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for terminated TDs (`cust_stat = 'T'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1004'`).

    4. **Select Relevant Columns**:
      - Select `ownrshp_comp_lvl_1_extl_id` as `co_number`, `CUST_COUNTRY_CD`, `cust_name` as `td_name`, and `cust_extl_id` as `td_id`.
    </reasoning>

    <sql>
    SELECT
        ownrshp_comp_lvl_1_extl_id AS co_number,
        CUST_COUNTRY_CD,
        cust_name AS td_name,
        cust_extl_id AS td_id
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'T'
      AND cust_type_cd = 'TD'
      AND ownrshp_comp_lvl_1_extl_id IN ('1004')
    GROUP BY ownrshp_comp_lvl_1_extl_id, CUST_COUNTRY_CD, cust_name, cust_extl_id;
    </sql>

    Q: What are the MCC CD and MCC Desc associated with Co_ID 1003?
    A:
    <reasoning>
    To find the MCC CD and MCC Desc associated with company ID 1003, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1003'`).

    4. **Select Relevant Columns**:
      - Select `OWNRSHP_COMP_LVL_1_NAME` as `co_name`, `ownrshp_comp_lvl_1_extl_id` as `co_number`, `mcc_cd`, and `mcc_desc`.
    </reasoning>

    <sql>
    SELECT
        OWNRSHP_COMP_LVL_1_NAME AS co_name,
        ownrshp_comp_lvl_1_extl_id AS co_number,
        mcc_cd,
        mcc_desc
    FROM EIS_D_CUST_PORTFOLIO
    WHERE ownrshp_comp_lvl_1_extl_id IN ('1003')
      AND cust_stat = 'A'
      AND cust_type_cd = 'TD'
    GROUP BY OWNRSHP_COMP_LVL_1_NAME, ownrshp_comp_lvl_1_extl_id, mcc_cd, mcc_desc;
    </sql>

    Q: What TD operate in Canada for co_id 1005?
    A:
    <reasoning>
    To find TDs operating in Canada for company ID 1005, we need to:

    1. **Filter Active TDs**, as the question is asking for TD type:
      - Use the `cust_stat` column to filter for active TDs (`cust_stat = 'A'`).

    2. **Filter by cust_type_cd**, as the question is asking for TD type:
      - Use the `cust_type_cd` column to filter for the cust_type (`cust_type_cd = 'TD'`).

    3. **Filter by Country**:
      - Use the `cust_country_Cd` column to filter for Canada (`cust_country_Cd IN ('CAN')`).

    4. **Filter by Company ID**:
      - Use the `ownrshp_comp_lvl_1_extl_id` column to filter for the specific company ID (`ownrshp_comp_lvl_1_extl_id = '1005'`).

    5. **Select Relevant Columns**:
      - Select `OWNRSHP_COMP_LVL_1_NAME` as `co_name`, `OWNRSHP_COMP_LVL_1_EXTL_ID` as `co_id`, `CUST_EXTL_ID` as `TD_ID`, `CUST_NAME` as `TD_Name`, and `CUST_COUNTRY_CD`.
    </reasoning>

    <sql>
    SELECT
        OWNRSHP_COMP_LVL_1_NAME AS co_name,
        OWNRSHP_COMP_LVL_1_EXTL_ID AS co_id,
        CUST_EXTL_ID AS TD_ID,
        CUST_NAME AS TD_Name,
        CUST_COUNTRY_CD
    FROM EIS_D_CUST_PORTFOLIO
    WHERE cust_stat = 'A'
      AND cust_type_cd = 'TD'
      AND cust_country_Cd IN ('CAN')
      AND ownrshp_comp_lvl_1_extl_id IN ('1005')
    GROUP BY OWNRSHP_COMP_LVL_1_NAME, OWNRSHP_COMP_LVL_1_EXTL_ID, CUST_EXTL_ID, CUST_NAME, CUST_COUNTRY_CD;
    </sql>

    Q: What is the gross sales for Co_ID 1001 in the month of September 2024?
    A:
    <reasoning>
    To find the gross sales for company ID 1001 in September 2024, we need to:

    1. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1005'`).

    2. **Filter by Month**:
      - Use the `subm_dt_yyyymm` column to filter for September 2024 (`subm_dt_yyyymm = '202409'`).

    3. **Filter by Sale Type**:
      - Use the `sale_refund_cd` column to filter for sales (`sale_refund_cd = 'S'`).

    4. **Aggregate Sales Data**:
      - Sum `gross_sales_usd` and `gross_sales_units` to get the total gross sales.
    </reasoning>

    <sql>
    SELECT
        co_id,
        sale_refund_cd,
        subm_dt_yyyymm AS month,
        SUM(gross_sales_usd) AS gross_sales_usd,
        SUM(gross_sales_units) AS gross_sales_units
    FROM PROD_BD_TH_FLAT_V3
    WHERE co_id IN ('1005')
      AND subm_dt_yyyymm IN ('202409')
      AND sale_refund_cd IN ('S')
    GROUP BY co_id, sale_refund_cd, subm_dt_yyyymm;
    </sql>

    Q: What is the processing volume and sales units for co_id 1005 for yesterday?
    A:
    <reasoning>
    To find the processing volume and sales units for company ID 1005 for yesterday, we need to:

    1. **Filter by Date**:
      - Use the `subm_dt` column to filter for yesterday's date (`subm_dt = date('now', '-1 day')`).

    2. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1005'`).

    3. **Filter by Sale Type**:
      - Use the `sale_refund_cd` column to filter for sales (`sale_refund_cd = 'S'`).

    4. **Aggregate Sales Data**:
      - Sum `gross_sales_units` and `gross_sales_usd` to get the total processing volume and sales units.
    </reasoning>

    <sql>
    SELECT
        co_id,
        subm_dt,
        SUM(gross_sales_units) AS gross_sales_units,
        SUM(gross_sales_usd) AS gross_sales_usd
    FROM PROD_BD_TH_FLAT_V3
    WHERE subm_dt = date('now', '-1 day')
      AND co_id IN ('1005')
      AND sale_refund_cd IN ('S')
    GROUP BY co_id, subm_dt;
    </sql>

    Q: What is the processing volume for CO_ID 1004 for last 6 months?
    A:
    <reasoning>
    To find the processing volume for company ID 1004 for the last 6 months, we need to:

    1. **Filter by Date Range**:
      - Use the `subm_dt` column to filter for the last 6 months (`subm_dt >= date('now', 'start of month', '-6 months')`).

    2. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1004'`).

    3. **Aggregate Sales Data**:
      - Sum `gross_sales_units` and `gross_sales_usd` to get the total processing volume.

    4. **Order by Sales Volume**:
      - Order the results by `gross_sales_usd` in descending order.
    </reasoning>

    <sql>
    SELECT
        co_id,
        SUM(gross_sales_units) AS gross_sales_units,
        SUM(gross_sales_usd) AS gross_sales_usd
    FROM PROD_BD_TH_FLAT_V3
    WHERE subm_dt >= date('now', 'start of month', '-6 months')
      AND co_id IN ('1004')
    GROUP BY co_id
    ORDER BY gross_sales_usd DESC;
    </sql>

    Q: What is the total gross sales unit by MOP code in the month of September 2024?
    A:
    <reasoning>
    To find the total sales unit by MOP code in the month of September 2024, we need to:

    1. **Filter by Date Range**:
      - Use the `subm_dt_yyyymm` column to filter for September 2024 (`subm_dt_yyyymm = '202409'`).

    2. **Filter by Company ID**:
      - Use the `co_id` column to filter for the specific company ID (`co_id = '1004'`).

    3. **Aggregate Sales Data**:
      - Sum `gross_sales_units`  to get the total unit.

    </reasoning>

    <sql>
    SELECT CASE WHEN mop_cd in ('VI','VR','CR','CZ') THEN 'VI' WHEN mop_cd in ('MC','MR') THEN 'MC' WHEN mop_cd in ('DI','DD','JC') THEN 'DI' ELSE mop_cd END brand,
        SUM(gross_sales_units) AS gross_sales_units,
    FROM PROD_BD_TH_FLAT_V3
    WHERE subm_dt_yyyymm IN ('202409')
    GROUP BY brand
    </sql>
